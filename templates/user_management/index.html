{% extends "layout.html" %}
{% block title %}ユーザー管理{% endblock %}
{% block content %}
<h1>ユーザー管理</h1>
<a href="{{ url_for('user_management_new') }}" style="display: inline-block; padding: 0.75rem 1.5rem; background: #3498db; color: white; text-decoration: none; border-radius: 4px; margin-bottom: 1rem;">ユーザーを追加</a>

<div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 1.5rem;">
    <h3 style="margin-top: 0;">並べ替え</h3>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <a href="{{ url_for('user_management', sort='created_at', order='desc') }}" style="padding: 0.5rem 1rem; background: {% if sort_by == 'created_at' and sort_order == 'desc' %}#3498db{% else %}#ecf0f1{% endif %}; color: {% if sort_by == 'created_at' and sort_order == 'desc' %}white{% else %}#333{% endif %}; text-decoration: none; border-radius: 4px; font-weight: 600;">作成日時（新順）</a>
        <a href="{{ url_for('user_management', sort='created_at', order='asc') }}" style="padding: 0.5rem 1rem; background: {% if sort_by == 'created_at' and sort_order == 'asc' %}#3498db{% else %}#ecf0f1{% endif %}; color: {% if sort_by == 'created_at' and sort_order == 'asc' %}white{% else %}#333{% endif %}; text-decoration: none; border-radius: 4px; font-weight: 600;">作成日時（旧順）</a>
        <a href="{{ url_for('user_management', sort='username', order='asc') }}" style="padding: 0.5rem 1rem; background: {% if sort_by == 'username' and sort_order == 'asc' %}#3498db{% else %}#ecf0f1{% endif %}; color: {% if sort_by == 'username' and sort_order == 'asc' %}white{% else %}#333{% endif %}; text-decoration: none; border-radius: 4px; font-weight: 600;">ユーザー名（A-Z）</a>
        <a href="{{ url_for('user_management', sort='email', order='asc') }}" style="padding: 0.5rem 1rem; background: {% if sort_by == 'email' and sort_order == 'asc' %}#3498db{% else %}#ecf0f1{% endif %}; color: {% if sort_by == 'email' and sort_order == 'asc' %}white{% else %}#333{% endif %}; text-decoration: none; border-radius: 4px; font-weight: 600;">メールアドレス（A-Z）</a>
    </div>
</div>

<table style="width: 100%; border-collapse: collapse;">
    <thead>
        <tr style="background: #f0f0f0; border-bottom: 2px solid #ddd;">
            <th style="padding: 1rem; text-align: left;">ユーザー名</th>
            <th style="padding: 1rem; text-align: left;">メールアドレス</th>
            <th style="padding: 1rem; text-align: left;">作成日時</th>
            <th style="padding: 1rem; text-align: center;">操作</th>
        </tr>
    </thead>
    <tbody>
        {% for user in users %}
        <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 1rem;">{{ user.username }}{% if user.email == 'admin@example.com' %}<span style="display: inline-block; margin-left: 0.5rem; padding: 0.25rem 0.75rem; background: #f39c12; color: white; border-radius: 4px; font-size: 0.8rem; font-weight: 600;">管理者</span>{% endif %}</td>
            <td style="padding: 1rem;">{{ user.email }}</td>
            <td style="padding: 1rem; color: #7f8c8d;">{{ user.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
            <td style="padding: 1rem; text-align: center;">
                <a href="{{ url_for('user_management_edit', user_id=user.id) }}" style="display: inline-block; padding: 0.5rem 1rem; background: #3498db; color: white; text-decoration: none; border-radius: 4px; margin-right: 0.5rem; font-size: 0.9rem;">編集</a>
                {% if user.id != current_user.id %}
                <form method="POST" action="{{ url_for('user_management_delete', user_id=user.id) }}" style="display: inline;">
                    <button type="submit" onclick="return confirm('本当に削除しますか？')" style="padding: 0.5rem 1rem; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem;">削除</button>
                </form>
                {% else %}
                <span style="display: inline-block; padding: 0.5rem 1rem; background: #bdc3c7; color: white; border-radius: 4px; font-size: 0.9rem; cursor: not-allowed;">削除（自分）</span>
                {% endif %}
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="4" style="padding: 2rem; text-align: center; color: #999;">ユーザーがありません</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
