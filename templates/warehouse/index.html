{% extends "layout.html" %}
{% block title %}å€‰åº«ç¢ºèª{% endblock %}
{% block content %}
<h1>å€‰åº«ç¢ºèª</h1>

<div style="margin-bottom: 2rem;">
    <h2 style="border-bottom: 2px solid #e74c3c; padding-bottom: 1rem; color: #e74c3c;">ğŸ“¦ å‡ºåº«å¾…ã¡ï¼ˆ{{ pending_orders|length }}ä»¶ï¼‰</h2>
    
    {% if pending_orders %}
    <div style="display: flex; flex-direction: column; gap: 1rem;">
        {% for order in pending_orders %}
        <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-left: 4px solid #e74c3c;">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 1rem; align-items: center; margin-bottom: 1rem;">
                <div>
                    <p style="margin: 0; font-size: 0.8rem; color: #7f8c8d;">ã‚°ãƒ«ãƒ¼ãƒ—</p>
                    <p style="margin: 0; font-weight: 600; font-size: 1rem;">{{ order.stock.group.name if order.stock.group else '-' }}</p>
                </div>
                <div>
                    <p style="margin: 0; font-size: 0.8rem; color: #7f8c8d;">å•†å“å</p>
                    <p style="margin: 0; font-weight: 600; font-size: 1rem;">{{ order.stock.product_name }}</p>
                </div>
                <div>
                    <p style="margin: 0; font-size: 0.8rem; color: #7f8c8d;">æ•°é‡</p>
                    <p style="margin: 0; font-weight: 600; font-size: 1.2rem; color: #e74c3c;">{{ order.quantity }}å€‹</p>
                </div>
                <div>
                    <p style="margin: 0; font-size: 0.8rem; color: #7f8c8d;">å‡ºè·å…ˆ</p>
                    <p style="margin: 0; font-weight: 600; font-size: 1rem;">{{ order.destination }}</p>
                </div>
                <button onclick="confirmOrder({{ order.id }})" style="padding: 0.75rem 1.5rem; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">âœ… ç¢ºèª</button>
            </div>
            <p style="margin: 0; color: #7f8c8d; font-size: 0.85rem;">å—ä»˜: {{ order.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p style="padding: 2rem; text-align: center; color: #999; background: white; border-radius: 8px;">å‡ºåº«å¾…ã¡ã®ã‚ªãƒ¼ãƒ€ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“</p>
    {% endif %}
</div>

<div style="margin-bottom: 2rem;">
    <h2 style="border-bottom: 2px solid #f39c12; padding-bottom: 1rem; color: #f39c12;">ğŸ“‹ å€‰åº«ç¢ºèªæ¸ˆã¿ï¼ˆ{{ confirmed_orders|length }}ä»¶ï¼‰</h2>
    
    {% if confirmed_orders %}
    <div style="display: flex; flex-direction: column; gap: 1rem;">
        {% for order in confirmed_orders %}
        <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-left: 4px solid #f39c12;">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 1rem; align-items: center; margin-bottom: 1rem;">
                <div>
                    <p style="margin: 0; font-size: 0.8rem; color: #7f8c8d;">ã‚°ãƒ«ãƒ¼ãƒ—</p>
                    <p style="margin: 0; font-weight: 600; font-size: 1rem;">{{ order.stock.group.name if order.stock.group else '-' }}</p>
                </div>
                <div>
                    <p style="margin: 0; font-size: 0.8rem; color: #7f8c8d;">å•†å“å</p>
                    <p style="margin: 0; font-weight: 600; font-size: 1rem;">{{ order.stock.product_name }}</p>
                </div>
                <div>
                    <p style="margin: 0; font-size: 0.8rem; color: #7f8c8d;">æ•°é‡</p>
                    <p style="margin: 0; font-weight: 600; font-size: 1.2rem; color: #f39c12;">{{ order.quantity }}å€‹</p>
                </div>
                <div>
                    <p style="margin: 0; font-size: 0.8rem; color: #7f8c8d;">å‡ºè·å…ˆ</p>
                    <p style="margin: 0; font-weight: 600; font-size: 1rem;">{{ order.destination }}</p>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <button onclick="completeOrder({{ order.id }})" style="padding: 0.75rem 1.5rem; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; white-space: nowrap;">âœ“ å®Œäº†</button>
                    <button onclick="revertOrder({{ order.id }})" style="padding: 0.75rem 1.5rem; background: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; white-space: nowrap;">â†¶ æˆ»ã™</button>
                </div>
            </div>
            <p style="margin: 0; color: #7f8c8d; font-size: 0.85rem;">ç¢ºèª: {{ order.warehouse_confirmed_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p style="padding: 2rem; text-align: center; color: #999; background: white; border-radius: 8px;">å€‰åº«ç¢ºèªæ¸ˆã¿ã®ã‚ªãƒ¼ãƒ€ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“</p>
    {% endif %}
</div>

<div>
    <h2 style="border-bottom: 2px solid #27ae60; padding-bottom: 1rem; color: #27ae60;">âœ… å‡ºåº«å®Œäº†ï¼ˆ{{ completed_orders|length }}ä»¶ï¼‰</h2>
    
    {% if completed_orders %}
    <div style="display: flex; flex-direction: column; gap: 1rem;">
        {% for order in completed_orders %}
        <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-left: 4px solid #27ae60; opacity: 0.8;">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 1rem; align-items: center; margin-bottom: 1rem;">
                <div>
                    <p style="margin: 0; font-size: 0.8rem; color: #7f8c8d;">ã‚°ãƒ«ãƒ¼ãƒ—</p>
                    <p style="margin: 0; font-weight: 600; font-size: 1rem;">{{ order.stock.group.name if order.stock.group else '-' }}</p>
                </div>
                <div>
                    <p style="margin: 0; font-size: 0.8rem; color: #7f8c8d;">å•†å“å</p>
                    <p style="margin: 0; font-weight: 600; font-size: 1rem;">{{ order.stock.product_name }}</p>
                </div>
                <div>
                    <p style="margin: 0; font-size: 0.8rem; color: #7f8c8d;">æ•°é‡</p>
                    <p style="margin: 0; font-weight: 600; font-size: 1.2rem; color: #27ae60;">{{ order.quantity }}å€‹</p>
                </div>
                <div>
                    <p style="margin: 0; font-size: 0.8rem; color: #7f8c8d;">å‡ºè·å…ˆ</p>
                    <p style="margin: 0; font-weight: 600; font-size: 1rem;">{{ order.destination }}</p>
                </div>
                <button onclick="revertOrder({{ order.id }})" style="padding: 0.75rem 1.5rem; background: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">â†¶ æˆ»ã™</button>
            </div>
            <p style="margin: 0; color: #7f8c8d; font-size: 0.85rem;">å®Œäº†: {{ order.completed_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p style="padding: 2rem; text-align: center; color: #999; background: white; border-radius: 8px;">å‡ºåº«å®Œäº†ã®ã‚ªãƒ¼ãƒ€ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“</p>
    {% endif %}
</div>

<script>
function confirmOrder(orderId) {
    fetch(`/warehouse/${orderId}/confirm`, { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('âœ… ' + data.message);
                location.reload();
            } else {
                alert('âŒ ' + data.message);
            }
        });
}

function completeOrder(orderId) {
    fetch(`/warehouse/${orderId}/complete`, { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('âœ… ' + data.message);
                location.reload();
            } else {
                alert('âŒ ' + data.message);
            }
        });
}

function revertOrder(orderId) {
    if (confirm('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æˆ»ã—ã¾ã™ã‹ï¼Ÿ')) {
        fetch(`/warehouse/${orderId}/revert`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('âœ… ' + data.message);
                    location.reload();
                } else {
                    alert('âŒ ' + data.message);
                }
            });
    }
}
</script>
{% endblock %}
